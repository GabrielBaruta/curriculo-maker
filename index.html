<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currículo Maker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- Fontes Google -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Roboto:wght@400;500;700&family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #f3f4f6;
        }

        /* Estilos da Folha A4 */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 20px auto;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        /* --- MODO EDIÇÃO --- */
        /* Elementos editáveis */
        body:not(.preview-mode) [contenteditable="true"] {
            outline: none;
            transition: background-color 0.2s;
            cursor: text;
            border-radius: 2px;
        }

        body:not(.preview-mode) [contenteditable="true"]:hover {
            background-color: rgba(255, 255, 0, 0.1);
            box-shadow: 0 0 0 1px rgba(0,0,0,0.1);
        }

        body:not(.preview-mode) [contenteditable="true"]:focus {
            background-color: rgba(235, 248, 255, 0.5);
            border-bottom: 2px solid #3b82f6;
        }

        /* Botões de controle (Lixeira, etc) */
        .control-btn {
            opacity: 0;
            transition: opacity 0.2s;
        }

        body:not(.preview-mode) .editable-group:hover .control-btn {
            opacity: 1;
        }

        /* Botões de Adicionar */
        .add-btn {
            display: inline-block;
        }

        /* --- MODO VISUALIZAÇÃO (PREVIEW) --- */
        body.preview-mode [contenteditable="true"] {
            cursor: default;
            outline: none;
        }
        
        body.preview-mode .control-btn,
        body.preview-mode .add-btn,
        body.preview-mode .camera-overlay {
            display: none !important;
        }

        /* Classes auxiliares */
        .no-print { display: block; }
        
        /* Foto de Perfil */
        .profile-pic-container {
            width: 140px;
            height: 140px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            background-color: #e5e7eb;
            transition: all 0.3s ease;
        }

        .profile-pic {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-overlay {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: rgba(0,0,0,0.5);
            color: white;
            text-align: center;
            padding: 5px 0;
            font-size: 12px;
            display: none;
        }
        body:not(.preview-mode) .profile-pic-container:hover .camera-overlay { display: block; }
        
        /* Modal */
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow: hidden; }

        /* --- TEMPLATE FONTS --- */
        .font-sans-std { font-family: 'Open Sans', sans-serif; }
        .font-serif-exec { font-family: 'Playfair Display', serif; } 
        .font-modern { font-family: 'Montserrat', sans-serif; } 
        .font-elegant { font-family: 'Lato', sans-serif; } 

        /* --- IMPRESSÃO NATIVA (Ctrl+P) --- */
        @media print {
            body { background-color: white; }
            nav, .no-print, .control-btn, .add-btn, .camera-overlay { display: none !important; }
            .a4-page {
                margin: 0;
                box-shadow: none;
                width: 100%;
                min-height: auto;
                page-break-after: always;
            }
            ::-webkit-scrollbar { display: none; }
        }

    </style>
</head>
<body class="pb-10 font-sans-std">

    <!-- Barra de Ferramentas -->
    <nav class="bg-white shadow-md p-4 sticky top-0 z-50 mb-6 print:hidden">
        <div class="max-w-7xl mx-auto flex flex-col lg:flex-row justify-between items-center gap-4">
            
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-3">
                    <i class="fas fa-file-invoice text-blue-600 text-2xl"></i>
                    <div class="flex flex-col">
                        <span class="font-bold text-xl text-gray-800 leading-tight">Currículo Maker</span>
                        <span class="text-xs text-gray-500">Editor Gratuito</span>
                    </div>
                </div>

                <!-- Texto Informativo (Visibilidade Corrigida) -->
                <div class="hidden md:flex items-center text-sm text-gray-500 border-l pl-6 h-8">
                    <i class="fas fa-info-circle mr-2 text-blue-400"></i> Clique nos textos para editar
                </div>
            </div>
            
            <div class="flex items-center gap-2 flex-wrap justify-center bg-gray-50 p-2 rounded-lg border border-gray-200">
                
                <!-- Seletor de Modelo -->
                <div class="flex items-center gap-2 border-r border-gray-300 pr-3 mr-1">
                    <label class="text-sm font-bold text-gray-700 hidden sm:inline"><i class="fas fa-layer-group mr-1"></i> Modelo:</label>
                    <select id="templateSelector" onchange="changeTemplate(this.value)" class="bg-white border border-gray-300 text-gray-700 text-sm rounded focus:ring-blue-500 focus:border-blue-500 block p-1.5 cursor-pointer">
                        <option value="minimalist">Minimalista</option>
                        <option value="executive">Executivo</option>
                        <option value="modern">Moderno</option>
                        <option value="elegant">Elegante</option>
                    </select>
                </div>

                <!-- Botões de Ação -->
                <button onclick="toggleModal('sectionsModal')" class="hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded transition text-sm font-medium flex items-center gap-1" title="Gerenciar Seções">
                    <i class="fas fa-list-check"></i> <span class="hidden sm:inline">Seções</span>
                </button>

                <button onclick="togglePreview()" id="previewBtn" class="hover:bg-purple-100 text-purple-700 px-3 py-1.5 rounded transition text-sm font-medium flex items-center gap-1" title="Ver como vai ficar">
                    <i class="fas fa-eye"></i> <span class="hidden sm:inline">Visualizar</span>
                </button>

                <button onclick="resetContent()" class="hover:bg-red-100 text-red-600 px-3 py-1.5 rounded transition text-sm font-medium flex items-center gap-1" title="Limpar tudo">
                    <i class="fas fa-rotate-left"></i>
                </button>

                <!-- Cor -->
                <div class="flex items-center gap-1 px-2 cursor-pointer border-l border-r border-gray-300 mx-1" title="Cor do Tema">
                    <i class="fas fa-palette text-pink-500"></i>
                    <input type="color" id="headerColor" value="#1a1a1a" class="w-6 h-6 p-0 border-0 rounded cursor-pointer" oninput="applyColor(this.value)">
                </div>

                <!-- Botão Baixar -->
                <button onclick="downloadPDF()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1.5 rounded shadow transition flex items-center gap-2 font-bold text-sm ml-1">
                    <i class="fas fa-download"></i> PDF
                </button>
            </div>
        </div>
    </nav>

    <!-- MODAL: Gerenciar Seções -->
    <div id="sectionsModal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50 print:hidden">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal('sectionsModal')"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3 border-b">
                    <p class="text-xl font-bold text-gray-800">Gerenciar Seções</p>
                    <div class="modal-close cursor-pointer z-50" onclick="toggleModal('sectionsModal')">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
                <div class="my-5 space-y-2">
                    <p class="text-xs text-gray-400 uppercase font-bold">Lateral</p>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-social', this.checked)" class="form-checkbox text-blue-600 rounded"><span>Redes Sociais</span></label>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-skills', this.checked)" class="form-checkbox text-blue-600 rounded"><span>Flash Skills</span></label>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-idiomas', this.checked)" class="form-checkbox text-blue-600 rounded"><span>Idiomas</span></label>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-cnh', this.checked)" class="form-checkbox text-blue-600 rounded"><span>CNH</span></label>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-ref', this.checked)" class="form-checkbox text-blue-600 rounded"><span>Referências</span></label>

                    <p class="text-xs text-gray-400 uppercase font-bold mt-4">Principal</p>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-objetivo', this.checked)" class="form-checkbox text-blue-600 rounded"><span>Objetivo</span></label>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-escolar', this.checked)" class="form-checkbox text-blue-600 rounded"><span>Histórico Escolar</span></label>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-experiencia', this.checked)" class="form-checkbox text-blue-600 rounded"><span>Histórico Profissional</span></label>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-projetos', this.checked)" class="form-checkbox text-blue-600 rounded"><span>Projetos</span></label>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-certificacoes', this.checked)" class="form-checkbox text-blue-600 rounded"><span>Certificações</span></label>
                    <label class="flex items-center space-x-2"><input type="checkbox" checked onchange="toggleSection('sec-artigos', this.checked)" class="form-checkbox text-blue-600 rounded"><span>Artigos</span></label>
                </div>
                <div class="flex justify-end pt-2 border-t">
                    <button class="bg-blue-600 text-white font-bold py-2 px-4 rounded text-sm" onclick="toggleModal('sectionsModal')">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DOCUMENTO A4 -->
    <div id="resume-document" class="a4-page flex flex-col font-sans-std text-gray-800">
        
        <!-- CABEÇALHO -->
        <header id="resume-header" class="bg-[#1a1a1a] text-white p-8 flex items-center gap-8 transition-colors duration-300">
            <!-- Foto -->
            <div id="photo-container" class="profile-pic-container rounded-full border-4 border-white shadow-lg flex-shrink-0" onclick="document.getElementById('fileInput').click()">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzljYTNhZiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iI2UzZTNiOCIgc3Ryb2tlPSJub25lIi8+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg==" 
                     id="profileImage" class="profile-pic" alt="Foto">
                <div class="camera-overlay"><i class="fas fa-camera"></i></div>
                <input type="file" id="fileInput" class="hidden" accept="image/*" onchange="loadPhoto(event)">
            </div>

            <!-- Info -->
            <div id="header-info" class="flex-grow text-left">
                <h1 contenteditable="true" class="text-4xl font-bold uppercase tracking-wider mb-2">Seu Nome</h1>
                <p contenteditable="true" class="text-xl opacity-90 font-light mb-4">Seu Cargo / Profissão</p>
                
                <div id="contact-info" class="flex flex-wrap gap-4 text-sm opacity-80">
                    <div class="flex items-center gap-2"><i class="fas fa-envelope"></i><span contenteditable="true">email@exemplo.com</span></div>
                    <div class="flex items-center gap-2"><i class="fas fa-phone"></i><span contenteditable="true">(11) 99999-9999</span></div>
                    <div class="flex items-center gap-2"><i class="fas fa-map-marker-alt"></i><span contenteditable="true">Cidade - UF</span></div>
                </div>
            </div>
        </header>

        <!-- CORPO -->
        <div id="resume-body" class="flex flex-grow flex-row">
            
            <!-- BARRA LATERAL -->
            <aside id="resume-sidebar" class="w-1/3 bg-gray-100 p-6 border-r border-gray-200 flex flex-col gap-6 order-first transition-colors duration-300">
                
                <div id="sec-social" class="editable-section">
                    <h3 class="section-title text-gray-800 font-bold uppercase border-b-2 border-gray-800 mb-3 pb-1 text-sm">Social</h3>
                    <ul id="social-list" class="text-sm space-y-2 text-gray-700">
                        <li class="editable-group flex items-center justify-between">
                            <div class="w-full flex items-center"><i class="fab fa-linkedin mr-2 text-gray-500"></i><span contenteditable="true">/seu-perfil</span></div>
                            <button class="control-btn text-red-500 ml-2 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                        </li>
                    </ul>
                    <button class="add-btn mt-1 text-xs text-blue-600 hover:underline no-print" onclick="addItem('social-list')">+ Rede</button>
                </div>

                <div id="sec-skills" class="editable-section">
                    <h3 class="section-title text-gray-800 font-bold uppercase border-b-2 border-gray-800 mb-3 pb-1 text-sm">Skills</h3>
                    <div id="skills-list" class="flex flex-wrap gap-2">
                        <span class="editable-group bg-gray-300 text-gray-800 text-xs px-2 py-1 rounded font-semibold flex items-center">
                            <span contenteditable="true">Liderança</span>
                            <i class="fas fa-times ml-2 cursor-pointer text-gray-500 hover:text-red-500 no-print" onclick="this.parentElement.remove()"></i>
                        </span>
                    </div>
                    <button class="add-btn mt-1 text-xs text-blue-600 hover:underline no-print" onclick="addSkill()">+ Skill</button>
                </div>

                <div id="sec-idiomas" class="editable-section">
                    <h3 class="section-title text-gray-800 font-bold uppercase border-b-2 border-gray-800 mb-3 pb-1 text-sm">Idiomas</h3>
                    <ul id="lang-list" class="text-sm space-y-2 text-gray-700">
                        <li class="editable-group flex justify-between">
                            <div><span contenteditable="true" class="font-bold">Inglês</span> - <span contenteditable="true">Interm.</span></div>
                            <button class="control-btn text-red-500 ml-2 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                        </li>
                    </ul>
                    <button class="add-btn mt-1 text-xs text-blue-600 hover:underline no-print" onclick="addItem('lang-list')">+ Idioma</button>
                </div>

                <div id="sec-cnh" class="editable-section">
                    <h3 class="section-title text-gray-800 font-bold uppercase border-b-2 border-gray-800 mb-3 pb-1 text-sm">CNH</h3>
                    <p class="text-sm text-gray-700" contenteditable="true">Categoria B</p>
                </div>

                 <div id="sec-ref" class="editable-section">
                    <h3 class="section-title text-gray-800 font-bold uppercase border-b-2 border-gray-800 mb-3 pb-1 text-sm">Referências</h3>
                    <ul id="ref-list" class="text-sm space-y-3 text-gray-700">
                        <li class="editable-group relative group">
                            <div contenteditable="true" class="font-bold">Nome</div>
                            <div contenteditable="true" class="italic text-xs">Cargo / Empresa</div>
                            <div contenteditable="true">Tel: (00) 0000-0000</div>
                            <button class="control-btn absolute top-0 right-0 text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                        </li>
                    </ul>
                    <button class="add-btn mt-1 text-xs text-blue-600 hover:underline no-print" onclick="addReference()">+ Ref</button>
                </div>

            </aside>

            <!-- CONTEÚDO PRINCIPAL -->
            <main id="resume-main" class="w-2/3 p-8 flex flex-col gap-6 text-gray-800 transition-colors duration-300">
                
                <section id="sec-objetivo">
                    <h3 class="section-title text-xl font-bold uppercase border-b-2 border-gray-300 mb-3 text-gray-900">Objetivo</h3>
                    <p contenteditable="true" class="text-sm leading-relaxed text-justify">
                        Profissional dedicado buscando oportunidades para aplicar conhecimentos e contribuir com resultados da organização.
                    </p>
                </section>

                <section id="sec-escolar">
                    <h3 class="section-title text-xl font-bold uppercase border-b-2 border-gray-300 mb-4 text-gray-900">Histórico Escolar</h3>
                    <div id="education-list" class="space-y-4">
                        <div class="editable-group relative hover:bg-gray-50 p-2 -mx-2 rounded transition">
                            <div class="flex justify-between items-baseline mb-1">
                                <h4 contenteditable="true" class="font-bold text-md">Curso Superior</h4>
                                <span contenteditable="true" class="text-sm text-gray-600 font-medium">2018 - 2022</span>
                            </div>
                            <div contenteditable="true" class="text-sm text-gray-700">Nome da Universidade</div>
                            <button class="control-btn absolute top-2 right-[-20px] text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <button class="add-btn mt-2 px-3 py-1 bg-blue-50 text-blue-600 text-xs font-bold rounded hover:bg-blue-100 no-print transition" onclick="addEducation()">+ Educação</button>
                </section>

                <section id="sec-experiencia">
                    <h3 class="section-title text-xl font-bold uppercase border-b-2 border-gray-300 mb-4 text-gray-900">Histórico Profissional</h3>
                    <div id="experience-list" class="space-y-4">
                        <div class="editable-group relative hover:bg-gray-50 p-2 -mx-2 rounded transition">
                            <div class="flex justify-between items-baseline mb-1">
                                <h4 contenteditable="true" class="font-bold text-lg">Cargo Ocupado</h4>
                                <span contenteditable="true" class="text-sm text-gray-600 font-medium">2021 - Atual</span>
                            </div>
                            <div contenteditable="true" class="font-semibold text-gray-700 text-sm mb-2">Nome da Empresa</div>
                            <p contenteditable="true" class="text-sm text-gray-600 leading-relaxed">
                                - Gestão de projetos e equipes.<br>
                                - Desenvolvimento de estratégias de vendas.
                            </p>
                            <button class="control-btn absolute top-2 right-[-20px] text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <button class="add-btn mt-2 px-3 py-1 bg-blue-50 text-blue-600 text-xs font-bold rounded hover:bg-blue-100 no-print transition" onclick="addExperience()">+ Experiência</button>
                </section>

                <!-- SEÇÃO PROJETOS (NOVA) -->
                <section id="sec-projetos">
                    <h3 class="section-title text-xl font-bold uppercase border-b-2 border-gray-300 mb-4 text-gray-900">Projetos</h3>
                    <div id="projects-list" class="space-y-4">
                        <div class="editable-group relative hover:bg-gray-50 p-2 -mx-2 rounded transition">
                            <div class="flex justify-between items-baseline mb-1">
                                <h4 contenteditable="true" class="font-bold text-md">Nome do Projeto</h4>
                                <span contenteditable="true" class="text-sm text-blue-600 italic cursor-pointer">Link</span>
                            </div>
                            <p contenteditable="true" class="text-sm text-gray-600 leading-relaxed">
                                Descrição breve do projeto, tecnologias utilizadas e impacto gerado.
                            </p>
                            <button class="control-btn absolute top-2 right-[-20px] text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <button class="add-btn mt-2 px-3 py-1 bg-blue-50 text-blue-600 text-xs font-bold rounded hover:bg-blue-100 no-print transition" onclick="addProject()">+ Projeto</button>
                </section>

                <section id="sec-certificacoes">
                    <h3 class="section-title text-xl font-bold uppercase border-b-2 border-gray-300 mb-4 text-gray-900">Certificações</h3>
                    <ul id="cert-list" class="list-disc pl-5 space-y-1 text-sm text-gray-700">
                        <li class="editable-group pl-1 relative">
                            <span contenteditable="true">Curso de Gestão de Tempo (2023)</span>
                            <button class="control-btn absolute right-[-20px] top-0 text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                        </li>
                    </ul>
                    <button class="add-btn mt-1 text-xs text-blue-600 hover:underline no-print" onclick="addItem('cert-list', true)">+ Certificação</button>
                </section>

                <section id="sec-artigos">
                    <h3 class="section-title text-xl font-bold uppercase border-b-2 border-gray-300 mb-4 text-gray-900">Artigos</h3>
                    <div id="article-list" class="space-y-2">
                        <div class="editable-group relative">
                            <p class="text-sm"><span contenteditable="true" class="font-bold">Título do Artigo</span> - <span contenteditable="true" class="italic">Revista/Site</span></p>
                            <button class="control-btn absolute right-[-20px] top-0 text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <button class="add-btn mt-1 text-xs text-blue-600 hover:underline no-print" onclick="addArticle()">+ Artigo</button>
                </section>

            </main>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // --- Configuração Global ---
        let currentTemplate = 'minimalist';
        let currentHeaderColor = '#1a1a1a'; // Cor padrão

        // --- 1. Lógica de Templates ---
        function changeTemplate(templateName) {
            currentTemplate = templateName;
            const doc = document.getElementById('resume-document');
            const header = document.getElementById('resume-header');
            const body = document.getElementById('resume-body');
            const sidebar = document.getElementById('resume-sidebar');
            const main = document.getElementById('resume-main');
            const photoContainer = document.getElementById('photo-container');
            const headerInfo = document.getElementById('header-info');
            const contactInfo = document.getElementById('contact-info');
            
            // Reset Básico de Classes e Estilos
            doc.className = "a4-page flex flex-col text-gray-800";
            header.style = ""; 
            sidebar.style = "";
            main.style = "";
            
            // Lógica por Modelo
            if (templateName === 'minimalist') {
                doc.classList.add('font-sans-std');
                
                header.className = "text-white p-8 flex items-center gap-8";
                header.style.backgroundColor = currentHeaderColor;
                
                headerInfo.className = "flex-grow text-left";
                contactInfo.className = "flex flex-wrap gap-4 text-sm opacity-80 justify-start";
                photoContainer.className = "profile-pic-container rounded-full border-4 border-white shadow-lg flex-shrink-0 w-[140px] h-[140px]";

                body.className = "flex flex-grow flex-row";
                sidebar.className = "w-1/3 bg-gray-100 p-6 border-r border-gray-200 flex flex-col gap-6 order-first text-left";
                main.className = "w-2/3 p-8 flex flex-col gap-6";
                
                updateSectionTitles("text-gray-800 font-bold uppercase border-b-2 border-gray-800 mb-3 pb-1", "text-xl font-bold uppercase border-b-2 border-gray-300 mb-3");

            } else if (templateName === 'executive') {
                doc.classList.add('font-serif-exec');
                
                header.className = "p-10 flex flex-col items-center justify-center text-center bg-white border-b-4 border-double";
                header.style.borderColor = currentHeaderColor; 
                header.style.color = "#111827";
                
                headerInfo.className = "w-full";
                const nameEl = headerInfo.querySelector('h1');
                if(nameEl) nameEl.className = "text-5xl font-bold uppercase tracking-widest mb-4";
                
                contactInfo.className = "flex flex-wrap gap-6 text-sm justify-center text-gray-600 uppercase tracking-wide";
                photoContainer.className = "hidden"; // Foto oculta no modo Executivo

                body.className = "flex flex-grow flex-row";
                sidebar.className = "w-1/3 bg-white p-8 border-l border-gray-200 flex flex-col gap-8 order-last text-right";
                main.className = "w-2/3 p-10 flex flex-col gap-8 order-first";

                updateSectionTitles(
                    "text-gray-900 font-bold uppercase tracking-widest border-b-2 border-gray-900 mb-4 pb-2 text-right text-xs", 
                    "text-2xl font-bold uppercase tracking-widest border-b-2 border-gray-900 mb-6 pb-2 text-gray-900"
                );

            } else if (templateName === 'modern') {
                doc.classList.add('font-modern');

                header.className = "p-8 flex items-center gap-6";
                header.style.backgroundColor = currentHeaderColor;
                header.style.color = "#ffffff";
                
                headerInfo.className = "text-left";
                contactInfo.className = "flex flex-col gap-1 text-sm opacity-90";
                photoContainer.className = "profile-pic-container rounded-lg shadow-md flex-shrink-0 w-36 h-36 border-0 block";
                photoContainer.querySelector('img').className = "w-full h-full object-cover";

                body.className = "flex flex-grow flex-row";
                sidebar.className = "w-1/3 bg-white p-6 flex flex-col gap-6 order-first text-left border-r-0";
                main.className = "w-2/3 p-8 flex flex-col gap-8 bg-gray-50";

                const sideTitles = document.querySelectorAll('#resume-sidebar .section-title');
                const mainTitles = document.querySelectorAll('#resume-main .section-title');
                
                sideTitles.forEach(el => {
                    el.className = "section-title font-bold uppercase mb-2 tracking-widest text-xs";
                    el.style.color = currentHeaderColor;
                    el.style.borderBottom = "none";
                });
                mainTitles.forEach(el => {
                    el.className = "section-title text-2xl font-bold mb-4";
                    el.style.color = currentHeaderColor;
                    el.style.borderBottom = "none";
                });

            } else if (templateName === 'elegant') {
                doc.classList.add('font-elegant');
                
                header.className = "p-12 flex items-start gap-8 bg-gray-50 border-b border-gray-200";
                header.style.color = "#333";
                
                headerInfo.className = "flex-grow pt-2";
                const nameEl = headerInfo.querySelector('h1');
                if(nameEl) nameEl.className = "text-4xl font-light tracking-[0.2em] uppercase mb-4";
                
                contactInfo.className = "flex flex-col gap-1 text-xs text-gray-500 tracking-widest uppercase";
                photoContainer.className = "profile-pic-container grayscale hover:grayscale-0 transition-all duration-500 rounded-sm w-32 h-32 block";

                body.className = "flex flex-grow flex-row";
                sidebar.className = "w-1/4 bg-white p-6 pt-10 border-r border-gray-100 flex flex-col gap-8 order-first text-left";
                main.className = "w-3/4 p-10 pt-10 flex flex-col gap-10 bg-white";

                const sideTitles = document.querySelectorAll('#resume-sidebar .section-title');
                const mainTitles = document.querySelectorAll('#resume-main .section-title');
                
                sideTitles.forEach(el => {
                    el.className = "section-title font-bold text-xs uppercase tracking-widest mb-4";
                    el.style.color = currentHeaderColor;
                    el.style.borderBottom = "none";
                });
                mainTitles.forEach(el => {
                    el.className = "section-title text-xl font-light uppercase tracking-widest mb-4 border-b border-gray-100 pb-2";
                    el.style.color = currentHeaderColor;
                });
            }
        }

        function updateSectionTitles(sidebarClass, mainClass) {
            const sideTitles = document.querySelectorAll('#resume-sidebar .section-title');
            const mainTitles = document.querySelectorAll('#resume-main .section-title');
            
            sideTitles.forEach(el => {
                el.className = "section-title " + sidebarClass;
                el.style.color = ""; 
                el.style.borderBottom = "";
            });
            mainTitles.forEach(el => {
                el.className = "section-title " + mainClass;
                el.style.color = "";
                el.style.borderBottom = "";
            });
        }

        function applyColor(color) {
            currentHeaderColor = color;
            changeTemplate(currentTemplate);
        }

        function resetContent() {
            if(confirm('Tem certeza que deseja resetar todo o conteúdo para o padrão? As suas edições serão perdidas.')) {
                location.reload();
            }
        }

        // --- NOVO: Modo Visualização (Preview) ---
        function togglePreview() {
            document.body.classList.toggle('preview-mode');
            const btn = document.getElementById('previewBtn');
            const isPreview = document.body.classList.contains('preview-mode');
            
            if(isPreview) {
                btn.innerHTML = '<i class="fas fa-edit"></i> <span class="hidden sm:inline">Editar</span>';
                btn.classList.remove('hover:bg-purple-100', 'text-purple-700');
                btn.classList.add('bg-purple-600', 'text-white', 'hover:bg-purple-700');
            } else {
                btn.innerHTML = '<i class="fas fa-eye"></i> <span class="hidden sm:inline">Visualizar</span>';
                btn.classList.remove('bg-purple-600', 'text-white', 'hover:bg-purple-700');
                btn.classList.add('hover:bg-purple-100', 'text-purple-700');
            }
        }

        // --- NOVO: Proteção de Saída ---
        window.addEventListener('beforeunload', function (e) {
            // Apenas ativa se houver alguma edição (simulado aqui sempre ativo para segurança)
            e.preventDefault();
            e.returnValue = '';
        });


        // --- Funções de Conteúdo ---
        function loadPhoto(event) {
            const image = document.getElementById('profileImage');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) { image.src = e.target.result; }
                reader.readAsDataURL(file);
            }
        }

        function toggleModal(modalID) {
            const modal = document.getElementById(modalID);
            const body = document.querySelector('body');
            modal.classList.toggle('opacity-0');
            modal.classList.toggle('pointer-events-none');
            body.classList.toggle('modal-active');
        }

        function toggleSection(sectionId, isChecked) {
            const section = document.getElementById(sectionId);
            if (section) section.style.display = isChecked ? 'block' : 'none';
        }

        // Adicionar Itens
        function addItem(listId, isBullet = false) {
            const list = document.getElementById(listId);
            const li = document.createElement('li');
            li.className = 'editable-group flex justify-between relative ' + (isBullet ? 'pl-1' : '');
            
            if(listId === 'social-list') {
                li.innerHTML = `<div class="w-full flex items-center"><i class="fas fa-link mr-2 text-gray-400"></i><span contenteditable="true">Link/Rede</span></div><button class="control-btn add-btn text-red-500 ml-2 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>`;
            } else if (listId === 'lang-list') {
                li.innerHTML = `<div><span contenteditable="true" class="font-bold">Idioma</span> - <span contenteditable="true">Nível</span></div><button class="control-btn add-btn text-red-500 ml-2 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>`;
            } else {
                li.innerHTML = `<span contenteditable="true">Nova informação</span><button class="control-btn add-btn absolute right-[-20px] top-0 text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>`;
            }
            list.appendChild(li);
        }

        function addSkill() {
            const list = document.getElementById('skills-list');
            const span = document.createElement('span');
            span.className = 'editable-group bg-gray-300 text-gray-800 text-xs px-2 py-1 rounded font-semibold flex items-center';
            span.innerHTML = `<span contenteditable="true">Nova Skill</span><i class="fas fa-times ml-2 cursor-pointer text-gray-500 hover:text-red-500 no-print control-btn" onclick="this.parentElement.remove()"></i>`;
            list.appendChild(span);
        }

        function addExperience() {
            const list = document.getElementById('experience-list');
            const div = document.createElement('div');
            div.className = 'editable-group relative hover:bg-gray-50 p-2 -mx-2 rounded transition';
            div.innerHTML = `<div class="flex justify-between items-baseline mb-1"><h4 contenteditable="true" class="font-bold text-lg">Cargo</h4><span contenteditable="true" class="text-sm text-gray-600 font-medium">Ano - Ano</span></div><div contenteditable="true" class="font-semibold text-gray-700 text-sm mb-2">Empresa</div><p contenteditable="true" class="text-sm text-gray-600 leading-relaxed">- Descrição...</p><button class="control-btn add-btn absolute top-2 right-[-20px] text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>`;
            list.appendChild(div);
        }

        function addEducation() {
            const list = document.getElementById('education-list');
            const div = document.createElement('div');
            div.className = 'editable-group relative hover:bg-gray-50 p-2 -mx-2 rounded transition';
            div.innerHTML = `<div class="flex justify-between items-baseline mb-1"><h4 contenteditable="true" class="font-bold text-md">Curso</h4><span contenteditable="true" class="text-sm text-gray-600 font-medium">Ano - Ano</span></div><div contenteditable="true" class="text-sm text-gray-700">Instituição</div><button class="control-btn add-btn absolute top-2 right-[-20px] text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>`;
            list.appendChild(div);
        }

        function addProject() {
            const list = document.getElementById('projects-list');
            const div = document.createElement('div');
            div.className = 'editable-group relative hover:bg-gray-50 p-2 -mx-2 rounded transition';
            div.innerHTML = `
                <div class="flex justify-between items-baseline mb-1">
                    <h4 contenteditable="true" class="font-bold text-md">Nome do Projeto</h4>
                    <span contenteditable="true" class="text-sm text-blue-600 italic cursor-pointer">Link</span>
                </div>
                <p contenteditable="true" class="text-sm text-gray-600 leading-relaxed">
                    Descrição do projeto e resultados.
                </p>
                <button class="control-btn add-btn absolute top-2 right-[-20px] text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
            `;
            list.appendChild(div);
        }

        function addArticle() {
            const list = document.getElementById('article-list');
            const div = document.createElement('div');
            div.className = 'editable-group relative';
            div.innerHTML = `<p class="text-sm"><span contenteditable="true" class="font-bold">Título</span> - <span contenteditable="true" class="italic">Local</span></p><button class="control-btn add-btn absolute right-[-20px] top-0 text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>`;
            list.appendChild(div);
        }

        function addReference() {
            const list = document.getElementById('ref-list');
            const li = document.createElement('li');
            li.className = 'editable-group relative group';
            li.innerHTML = `<div contenteditable="true" class="font-bold">Nome</div><div contenteditable="true" class="italic text-xs">Empresa</div><div contenteditable="true">Contato</div><button class="control-btn add-btn absolute top-0 right-0 text-red-500 no-print" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>`;
            list.appendChild(li);
        }

        function downloadPDF() {
            // Força a remoção do preview mode para garantir que o PDF saia limpo
            const wasPreview = document.body.classList.contains('preview-mode');
            if(!wasPreview) document.body.classList.add('preview-mode');

            const element = document.getElementById('resume-document');
            const opt = {
                margin: 0,
                filename: 'meu-curriculo.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            document.body.classList.add('generating-pdf');
            html2pdf().set(opt).from(element).save().then(() => {
                document.body.classList.remove('generating-pdf');
                // Restaura o estado original
                if(!wasPreview) document.body.classList.remove('preview-mode');
            });
        }
    </script>
</body>
</html>
